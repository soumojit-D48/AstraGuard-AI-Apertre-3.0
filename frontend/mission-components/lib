/**
 * AstraGuard AI API Hooks
 * Custom React hooks for fetching data from the backend
 */

"use client";

import { useState, useEffect } from "react";
import { apiClient } from "./api-client";

/**
 * Hook to fetch system status
 */
export function useSystemStatus() {
  const [status, setStatus] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchStatus = async () => {
      try {
        const data = await apiClient.getStatus();
        setStatus(data);
      } catch (err) {
        setError(err instanceof Error ? err.message : "Failed to fetch status");
      } finally {
        setLoading(false);
      }
    };

    fetchStatus();
  }, []);

  return { status, loading, error };
}

/**
 * Hook to fetch current mission phase
 */
export function usePhase() {
  const [phase, setPhase] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchPhase = async () => {
      try {
        const data = await apiClient.getPhase();
        setPhase(data.phase);
      } catch (err) {
        setError(err instanceof Error ? err.message : "Failed to fetch phase");
      } finally {
        setLoading(false);
      }
    };

    fetchPhase();
  }, []);

  return { phase, loading, error };
}

/**
 * Hook to fetch anomaly history
 */
export function useAnomalyHistory(limit?: number) {
  const [anomalies, setAnomalies] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchHistory = async () => {
      try {
        const data = await apiClient.getAnomalyHistory(limit);
        setAnomalies(data.anomalies || []);
      } catch (err) {
        setError(err instanceof Error ? err.message : "Failed to fetch anomalies");
      } finally {
        setLoading(false);
      }
    };

    fetchHistory();
  }, [limit]);

  return { anomalies, loading, error };
}

/**
 * Hook to fetch memory stats
 */
export function useMemoryStats() {
  const [stats, setStats] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchStats = async () => {
      try {
        const data = await apiClient.getMemoryStats();
        setStats(data);
      } catch (err) {
        setError(err instanceof Error ? err.message : "Failed to fetch memory stats");
      } finally {
        setLoading(false);
      }
    };

    fetchStats();
  }, []);

  return { stats, loading, error };
}

/**
 * Hook to check backend health
 */
export function useHealthCheck() {
  const [isHealthy, setIsHealthy] = useState<boolean | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const checkHealth = async () => {
      try {
        const data = await apiClient.healthCheck();
        setIsHealthy(data.status === "ok");
      } catch (err) {
        setIsHealthy(false);
        setError(err instanceof Error ? err.message : "Backend unreachable");
      } finally {
        setLoading(false);
      }
    };

    checkHealth();
  }, []);

  return { isHealthy, loading, error };
}
